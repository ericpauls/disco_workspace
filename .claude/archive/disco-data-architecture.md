# DiSCO Data Architecture

> **Purpose**: This document explains how DiSCO's data tables, UUIDs, and services work together to turn raw sensor observations into a unified Common Operating Picture. A developer should be able to read this and understand exactly how data flows from endpoints to the live world model.

---

## Table of Contents

1. [Overview](#1-overview)
2. [The UUID System](#2-the-uuid-system)
3. [Database Tables](#3-database-tables)
4. [Data Flow: Entity Reports to Live World](#4-data-flow-entity-reports-to-live-world)
5. [Data Flow: Position Reports to Live World](#5-data-flow-position-reports-to-live-world)
6. [UUID Relationships Diagram](#6-uuid-relationships-diagram)
7. [Signal Parameters Reference](#7-signal-parameters-reference)
8. [Geolocation & Uncertainty Modeling](#8-geolocation--uncertainty-modeling)
9. [Key Design Principles](#9-key-design-principles)
10. [API Endpoints Reference](#10-api-endpoints-reference)

---

## 1. Overview

DiSCO (Distributed Spectrum Collaboration & Operations) collects electromagnetic spectrum data from distributed sensors ("endpoints"), fuses it into tracked entities, and presents a unified live world view.

**Key Concepts:**

- **DiSCO Endpoints**: EW/ELINT payloads (like DECEPTOR) that observe the RF spectrum and report what they detect
- **Entity Reports**: What an endpoint observes - "I see a radar at this location with these signal characteristics"
- **Position Reports**: Where an endpoint is - "I am at this location with this heading"
- **Fusion**: Server-side correlation and summarization of multiple reports into tracked entities
- **Live World Model**: The final, canonical view - one row per tracked physical entity

**Two Paths to Live World:**

1. **Fused Path**: Entity Reports → Correlation → Summarization → Live World (for detected emitters) **[PLANNED - NOT YET IMPLEMENTED]**
2. **Direct Path**: Position Reports → Live World (for DiSCO endpoint self-locations) **✓ IMPLEMENTED**

> **⚠️ IMPLEMENTATION STATUS**: The current emulator implements entity/position report storage and the Direct Path. The Fused Path (correlation, summarization, fusion tables) is documented but not yet implemented.
>
> **Live World Update Pattern**: The emulator uses `POST /liveWorldModel` for new entities (server assigns `liveworldmodel_uuid`) and `PUT /liveWorldModel` for updates (referencing the server-assigned UUID). This aligns with the official DiSCO API — no batch/sync endpoints are used. The emulator maintains an internal map of entity UUIDs to server-assigned live world UUIDs.

---

## 2. The UUID System

DiSCO uses two UUID namespaces to track data provenance: **source-side** (generated by endpoints) and **server-side** (assigned by the server).

### Source UUIDs (Endpoint-Generated)

These are created by DiSCO endpoints and sent with all messages.

| UUID Field | Description | Lifetime |
|------------|-------------|----------|
| `source_payload_uuid` | Unique ID for the endpoint/payload. Assigned when endpoint first registers with DiSCO server. | Constant for lifetime of endpoint |
| `source_entity_uuid` | Endpoint's internal tracking ID for an entity it observes. | May be reused (smart endpoints) or unique per observation (simple endpoints) |
| `source_position_report_uuid` | Endpoint's ID for a specific position report it sends. | Unique per report |
| `source_pulsedata_uuid` | Endpoint's ID for raw pulse data (PDWs). | Unique per pulse collection |

### Server UUIDs (DiSCO Server-Assigned)

These are assigned by the server when data is received and stored.

| UUID Field | Description | Assignment |
|------------|-------------|------------|
| `entity_msg_uuid` | Server-assigned ID for each entity report. | One per incoming report (even if source_entity_uuid repeats) |
| `group_uuid` / `group_num` | Correlation group ID. Assigned by fusion service. | One per unique physical entity (ideally) |
| `liveworldmodel_uuid` | Server-assigned ID for live world entries. | One per live world row |

### Critical Insight: Why Two UUID Systems?

The server assigns a **NEW** `entity_msg_uuid` for every incoming entity report, regardless of the `source_entity_uuid`. This is because:

1. **Server cannot trust endpoint correlation** - Some endpoints are "smart" and track entities internally (reusing source_entity_uuid for the same physical entity), while others report every observation as unique.
2. **Correlation is server-side** - The fusion service uses signal characteristics and geolocation to determine which reports belong together, independent of what the endpoint thinks.

**Example:**
```
Endpoint A reports source_entity_uuid = "ent-123" three times
Server assigns: entity_msg_uuid = "msg-001", "msg-002", "msg-003"
Correlation service determines these are all the same physical entity
All three get: group_uuid = "group-555"
```

---

## 3. Database Tables

### 3.1 entities

**Purpose**: Raw entity reports from endpoints. One row per observation.

| Column | Type | Description |
|--------|------|-------------|
| `entity_msg_uuid` | UUID | **Primary key** (server-assigned) |
| `source_entity_uuid` | UUID | Endpoint's internal entity ID |
| `source_payload_uuid` | UUID | Which endpoint sent this report |
| `pulsedata_uuid` | UUID | Optional reference to associated pulse data |
| `position` | Position | **Estimated location of the observed entity** (NOT the observer) |
| `ellipse` | Ellipse | Position uncertainty bounds |
| `frequency_range` | FrequencyRange | Measured RF frequency (min/max/avg) |
| `pri_range` | PriRange | Measured pulse repetition interval |
| `pulsewidth_range` | PwRange | Measured pulse width |
| `amplitude_avg` | number | Average signal amplitude (dBm) |
| `elnot` | string | ELNOT identifier |
| `emitter_type` | string | RADAR, COMMUNICATIONS, JAMMER, MISSILE, etc. |
| `modulation` | string | PULSED, PULSE_DOPPLER, CW, FHSS, etc. |
| `latest_timestamp` | integer | Unix timestamp (ms) |
| `created_timestamp` | integer | Server creation time (ms) |
| `observation_distance_km` | number \| null | Optional: Distance from observer to entity |
| `observation_bearing_deg` | number \| null | Optional: Bearing from observer to entity |

**Important**: All signal parameters are **MEASURED values** as perceived by the endpoint, including measurement noise/error.

### 3.2 positionReports

**Purpose**: Endpoint self-reported positions. One row per report.

| Column | Type | Description |
|--------|------|-------------|
| `position_report_uuid` | UUID | **Primary key** (server-assigned) |
| `source_position_report_uuid` | UUID | Endpoint's internal report ID |
| `source_payload_uuid` | UUID | Which endpoint sent this report |
| `position` | Position | Endpoint's current location (lat/lon/alt) |
| `dof` | DOF | Degrees of freedom (pitch/roll/yaw) |
| `magnetic_heading` | number | Current heading |
| `heading` | number | Current heading (degrees) |
| `speed` | number | Current speed |
| `altitude_reference` | string | Altitude reference system |
| `latest_timestamp` | integer | Unix timestamp (ms) |
| `created_timestamp` | integer | Server creation time (ms) |

### 3.3 fusedEntityMapping **[PLANNED - NOT YET IMPLEMENTED]**

**Purpose**: Links entity reports to correlation groups. Created by the correlation service.

| Column | Type | Description |
|--------|------|-------------|
| `entity_msg_uuid` | UUID | References entities table |
| `group_uuid` | UUID | The correlation group this report belongs to |

**Relationship**: Many `entity_msg_uuid` → One `group_uuid`

The correlation service determines which entity reports "belong together" (represent the same physical entity) and assigns them the same `group_uuid`. This handles:

- Multiple observations from the same endpoint over time
- Observations from multiple different endpoints seeing the same entity
- Forming new groups when no existing group matches a new observation

### 3.4 fusedEntitySummary **[PLANNED - NOT YET IMPLEMENTED]**

**Purpose**: State estimates per correlation group. New row created on each state change.

| Column | Type | Description |
|--------|------|-------------|
| `summary_uuid` | UUID | **Primary key** (server-assigned) |
| `group_uuid` | UUID | Which correlation group this summarizes |
| `group_num` | integer | Numeric group identifier |
| `position` | Position | Fused/triangulated position estimate |
| `frequency_range` | FrequencyRange | Aggregated frequency characteristics |
| `latest_timestamp` | integer | Most recent observation time |
| `initial_timestamp` | integer | First detection time |
| (+ aggregated signal parameters) | | |

**Key Insight**: Each update creates a **NEW row** (historical record). The fusion service writes new summaries when it believes the group's state has changed, typically due to new correlated entity reports. This enables:

- Forensic analysis of how estimates evolved over time
- Rollback/audit capabilities
- Historical track reconstruction

The Live World service queries for the **latest** summary per group_uuid.

### 3.5 liveWorldModel

**Purpose**: Canonical real-time view. Exactly ONE row per unique physical entity OR endpoint.

| Column | Type | Description |
|--------|------|-------------|
| `liveworldmodel_uuid` | UUID | **Primary key** (server-assigned) |
| `origin` | string | `"fused_entity_summary"` OR `"position_report"` |
| `origin_uuid` | UUID | References the source row in the origin table |
| `entity_msg_uuid` | UUID | (for fused entities) |
| `group_num` | integer | (for fused entities, redundant but convenient) |
| `position` | Position | Current position |
| `latest_timestamp` | integer | Last update time |
| `write_timestamp` | integer | When row was written to DB |
| (+ entity attributes) | | |

**The Origin System:**

Live World has two sources of data, tracked by the `origin` and `origin_uuid` columns:

1. **`origin = "fused_entity_summary"`**: Row was created/updated based on a fused entity summary. The `origin_uuid` points to the specific summary row.

2. **`origin = "position_report"`**: Row was created/updated based on an endpoint position report. The `origin_uuid` points to the specific position report row.

**Total rows in Live World** = Number of tracked entities + Number of DiSCO endpoints

---

## 4. Data Flow: Entity Reports to Live World

This is the "Fused Path" - how endpoint observations become tracked entities.

```
DiSCO Endpoint (DECEPTOR, etc.)
         │
         │ Entity Report
         │ (source_entity_uuid, source_payload_uuid, position, signal params)
         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│ DiSCO Server                                                             │
│                                                                          │
│   1. RECEIVE: Entity report arrives via API                             │
│   2. STAMP: Server assigns entity_msg_uuid (new UUID for every report)  │
│   3. STORE: Write to entities table                                     │
│                         │                                                │
│                         ▼                                                │
│   ┌───────────────────────────────────────┐                             │
│   │ CORRELATION SERVICE                    │                             │
│   │                                        │                             │
│   │ - Compare new report against existing  │                             │
│   │   groups using:                        │                             │
│   │   • Signal characteristics match       │                             │
│   │   • Geographic proximity               │                             │
│   │   • Temporal consistency               │                             │
│   │                                        │                             │
│   │ - Decision:                            │                             │
│   │   • MATCH: Assign to existing group_uuid│                            │
│   │   • NO MATCH: Create new group_uuid    │                             │
│   └───────────────────────────────────────┘                             │
│                         │                                                │
│                         ▼                                                │
│   fusedEntityMapping table: entity_msg_uuid → group_uuid                 │
│                         │                                                │
│                         ▼                                                │
│   ┌───────────────────────────────────────┐                             │
│   │ SUMMARIZATION SERVICE                  │                             │
│   │                                        │                             │
│   │ - For each group with new reports:     │                             │
│   │   • Triangulate position from multiple │                             │
│   │     sensor reports                     │                             │
│   │   • Aggregate signal parameters        │                             │
│   │   • Apply tracking/prediction models   │                             │
│   │                                        │                             │
│   │ - Output: New FusedEntitySummary row   │                             │
│   └───────────────────────────────────────┘                             │
│                         │                                                │
│                         ▼                                                │
│   fusedEntitySummary table: (new row for group_uuid with updated state)  │
│                         │                                                │
│                         ▼                                                │
│   ┌───────────────────────────────────────┐                             │
│   │ LIVE WORLD MODEL SERVICE               │                             │
│   │                                        │                             │
│   │ - Query latest summary per group_uuid  │                             │
│   │ - Update or create live world row:     │                             │
│   │   • origin = "fused_entity_summary"    │                             │
│   │   • origin_uuid = summary row UUID     │                             │
│   │   • Copy position, signal params, etc. │                             │
│   └───────────────────────────────────────┘                             │
│                         │                                                │
│                         ▼                                                │
│   liveWorldModel table: (one row per group, updated)                     │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 5. Data Flow: Position Reports to Live World

This is the "Direct Path" - how endpoint self-locations appear in live world.

```
DiSCO Endpoint
         │
         │ Position Report
         │ (source_position_report_uuid, source_payload_uuid, position, heading)
         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│ DiSCO Server                                                             │
│                                                                          │
│   1. RECEIVE: Position report arrives via API                           │
│   2. STAMP: Server assigns position_report_uuid                         │
│   3. STORE: Write to positionReports table                              │
│                         │                                                │
│                         ▼                                                │
│   ┌───────────────────────────────────────┐                             │
│   │ LIVE WORLD MODEL SERVICE               │                             │
│   │                                        │                             │
│   │ - Find existing row for this           │                             │
│   │   source_payload_uuid, OR create new   │                             │
│   │                                        │                             │
│   │ - Update:                              │                             │
│   │   • origin = "position_report"         │                             │
│   │   • origin_uuid = position report UUID │                             │
│   │   • Copy position, heading, etc.       │                             │
│   └───────────────────────────────────────┘                             │
│                         │                                                │
│                         ▼                                                │
│   liveWorldModel table: (one row per endpoint)                           │
└─────────────────────────────────────────────────────────────────────────┘
```

**Key Difference from Fused Path**: Position reports bypass correlation and summarization entirely. They go directly to live world because:

1. We know exactly which endpoint sent them (source_payload_uuid is trusted)
2. No fusion is needed - the endpoint knows its own location
3. One endpoint = one live world row (no grouping required)

---

## 6. UUID Relationships Diagram

This diagram shows how all the UUIDs relate across tables:

```
┌──────────────────────────────────────────────────────────────────────────┐
│                         SOURCE-SIDE (Endpoint)                            │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  source_payload_uuid ───────────────────────────────────────────────┐    │
│  (constant endpoint identity)                                        │    │
│         │                                                            │    │
│         ├──── Entity Report ─────────────────────────────────────────┼──▶ │
│         │       ├── source_entity_uuid                               │    │
│         │       └── pulsedata_uuid (optional ref)                    │    │
│         │                                                            │    │
│         ├──── Position Report ───────────────────────────────────────┼──▶ │
│         │       └── source_position_report_uuid                      │    │
│         │                                                            │    │
│         └──── Pulse Data ────────────────────────────────────────────┼──▶ │
│                 └── source_pulsedata_uuid                            │    │
│                                                                      │    │
└──────────────────────────────────────────────────────────────────────│────┘
                                                                       │
┌──────────────────────────────────────────────────────────────────────│────┐
│                         SERVER-SIDE                                   │    │
├──────────────────────────────────────────────────────────────────────│────┤
│                                                                       ▼    │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │ entities table                                                       │  │
│  │ ┌──────────────────┬──────────────────┬────────────────────┐        │  │
│  │ │ entity_msg_uuid  │ source_entity_   │ source_payload_    │        │  │
│  │ │ (server-assigned)│ uuid             │ uuid               │        │  │
│  │ ├──────────────────┼──────────────────┼────────────────────┤        │  │
│  │ │ e-msg-001        │ src-ent-A        │ payload-001        │        │  │
│  │ │ e-msg-002        │ src-ent-A        │ payload-001        │ (same) │  │
│  │ │ e-msg-003        │ src-ent-B        │ payload-002        │        │  │
│  │ │ e-msg-004        │ src-ent-C        │ payload-002        │        │  │
│  │ └──────────────────┴──────────────────┴────────────────────┘        │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│                          │                                                 │
│                          ▼ (correlation service)                           │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │ fusedEntityMapping                                                   │  │
│  │ ┌──────────────────┬──────────────────┐                             │  │
│  │ │ entity_msg_uuid  │ group_uuid       │ ◀── Many-to-one             │  │
│  │ ├──────────────────┼──────────────────┤                             │  │
│  │ │ e-msg-001        │ group-001        │                             │  │
│  │ │ e-msg-002        │ group-001        │ ← Same physical entity      │  │
│  │ │ e-msg-003        │ group-001        │ ← (correlated together)     │  │
│  │ │ e-msg-004        │ group-002        │ ← Different physical entity │  │
│  │ └──────────────────┴──────────────────┘                             │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│                          │                                                 │
│                          ▼ (summarization service)                         │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │ fusedEntitySummary (HISTORICAL - new row per update)                 │  │
│  │ ┌──────────────────┬──────────────────┬─────────────────────┐       │  │
│  │ │ summary_uuid     │ group_uuid       │ position (fused)    │       │  │
│  │ ├──────────────────┼──────────────────┼─────────────────────┤       │  │
│  │ │ sum-001          │ group-001        │ lat/lon v1          │       │  │
│  │ │ sum-002          │ group-001        │ lat/lon v2 (updated)│ ← new │  │
│  │ │ sum-003          │ group-002        │ lat/lon             │       │  │
│  │ └──────────────────┴──────────────────┴─────────────────────┘       │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│                          │                                                 │
│                          ▼ (live world service)                            │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │ liveWorldModel (ONE row per physical thing)                          │  │
│  │ ┌────────────────┬──────────────────────┬──────────────┬─────────┐  │  │
│  │ │ liveworldmodel │ origin               │ origin_uuid  │ pos ... │  │  │
│  │ │ _uuid          │                      │              │         │  │  │
│  │ ├────────────────┼──────────────────────┼──────────────┼─────────┤  │  │
│  │ │ lw-001         │ fused_entity_summary │ sum-002      │ ...     │  │  │
│  │ │ lw-002         │ fused_entity_summary │ sum-003      │ ...     │  │  │
│  │ │ lw-003         │ position_report      │ pos-rpt-001  │ ...     │  │  │
│  │ └────────────────┴──────────────────────┴──────────────┴─────────┘  │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. Signal Parameters Reference

Entity reports contain **MEASURED** signal parameters - values as perceived by the endpoint, including measurement noise/error.

### 7.1 FrequencyRange

```typescript
interface FrequencyRange {
  frequency_min: number;   // Minimum observed frequency (MHz)
  frequency_max: number;   // Maximum observed frequency (MHz)
  frequency_avg: number;   // Average/center frequency (MHz)
}
```

**Realistic Frequency Bands by Emitter Type:**

| Emitter Type | Frequency Range (MHz) | Band | Example Systems |
|--------------|----------------------|------|-----------------|
| SAM Acquisition Radar | 1800-3100 | S-band | SA-20, SA-21 |
| SAM Tracking Radar | 9000-10500 | X-band | SA-20 TRK |
| Naval Radar | 850-3500 | UHF to S-band | SPY-1, SPY-6, SPS-49 |
| Airborne Radar | 8000-12500 | X-band | APG-77, APG-81, APG-79 |
| AEW/AWACS | 400-1400 | UHF to L-band | APY-9, SHMEL-M |
| Communications | 2-400 | HF to UHF | HF Voice, UHF SATCOM, Link-16 |
| Jammers | 64-18000 | Multi-band | ALQ-99, ALQ-249 |
| Missile Seekers | 10000-18000 | X to Ku-band | SA-N-6, AAM seekers |

### 7.2 PriRange (Pulse Repetition Interval)

```typescript
interface PriRange {
  pri_min: number;   // Minimum PRI (microseconds)
  pri_max: number;   // Maximum PRI (microseconds)
  pri_avg: number;   // Average PRI (microseconds)
}
```

**Realistic PRI Values:**

| Radar Type | PRI Range (μs) | Typical (μs) | Notes |
|------------|---------------|--------------|-------|
| Long-range search | 1000-4500 | 2000+ | Lower PRF for unambiguous range |
| Medium-range | 500-1200 | 800 | Balanced range/velocity |
| Fire control/tracking | 50-300 | 150 | Higher PRF for velocity |
| Airborne fighter | 30-220 | 100 | High PRF modes |
| Missile seeker | 30-150 | 75 | Terminal guidance |

**Note:** Communications and jammers typically have `null` PRI (continuous wave or noise modulation).

### 7.3 PulsewidthRange

```typescript
interface PulsewidthRange {
  pulsewidth_min: number;   // Minimum pulse width (microseconds)
  pulsewidth_max: number;   // Maximum pulse width (microseconds)
  pulsewidth_avg: number;   // Average pulse width (microseconds)
}
```

**Realistic Pulsewidth Values:**

| Radar Type | Pulsewidth Range (μs) | Typical (μs) |
|------------|----------------------|--------------|
| Long-range search | 50-150 | 100 |
| SAM acquisition | 10-50 | 25 |
| Fire control | 0.5-2 | 1 |
| Airborne AESA | 0.1-1.2 | 0.5 |
| Missile seeker | 0.05-0.5 | 0.2 |
| AEW | 2-15 | 8 |

### 7.4 Amplitude

```typescript
amplitude_avg: number;   // Average signal amplitude (dBm)
```

**Realistic Amplitude Ranges:**

| Signal Type | Amplitude Range (dBm) | Notes |
|-------------|----------------------|-------|
| Strong radar | -20 to -40 | Close range, main beam |
| Medium radar | -40 to -55 | Typical detection |
| Weak radar | -55 to -70 | Edge of detection |
| Communications | -45 to -90 | Varies with distance/power |
| Jammers | -10 to -35 | Intentionally high power |

### 7.5 Modulation Types

```typescript
type Modulation =
  | 'PULSED'        // Basic pulsed radar
  | 'PULSE_DOPPLER' // Modern radar with velocity measurement
  | 'CW'            // Continuous wave (missile seekers, illuminators)
  | 'FMCW'          // Frequency modulated CW
  | 'CHIRP'         // Linear FM pulse compression
  | 'FM'            // Frequency modulation (comms)
  | 'SSB'           // Single sideband (HF voice)
  | 'FHSS'          // Frequency hopping spread spectrum (Link-16)
  | 'FSK'           // Frequency shift keying
  | 'QPSK'          // Quadrature PSK (SATCOM)
  | 'PPM'           // Pulse position modulation (ADS-B)
  | 'NOISE_JAM'     // Noise jamming
  | 'DECEPTIVE';    // Deceptive jamming (ALQ systems)
```

---

## 8. Geolocation & Uncertainty Modeling

### 8.1 Position Field in Entity Reports

The `position` field in an entity report represents the **estimated location of the observed entity** (NOT the observer's location). This is a geolocation estimate that includes error from:

- Single-sensor techniques (AOA, TDOA, differential amplitude)
- Multilateration uncertainty
- Propagation effects (atmospheric, multipath)
- Sensor geometry (baseline, distance to target)

### 8.2 Ellipse (Uncertainty Bounds)

```typescript
interface Ellipse {
  orientation?: number;             // Degrees from true north (0-360)
  semi_major_axis_length?: number;  // Meters
  semi_minor_axis_length?: number;  // Meters
}
```

The ellipse represents the **1-sigma (68%) confidence region** for the position estimate.

**Factors Affecting Ellipse Size:**

| Factor | Effect on Uncertainty |
|--------|----------------------|
| **Distance to target** | Larger distance = larger ellipse |
| **Sensor type** | DF sensors have elongated ellipses along bearing |
| **Multi-sensor fusion** | Multiple sensors reduce uncertainty |
| **Signal strength** | Weak signals = larger uncertainty |
| **Geometry** | Poor sensor geometry = larger ellipse |

**Realistic Uncertainty Values (single sensor):**

| Sensor Type | Semi-major (m) | Semi-minor (m) | Notes |
|-------------|---------------|----------------|-------|
| High-accuracy DF | 500-2000 | 100-500 | Good geometry |
| Low-accuracy DF | 2000-10000 | 500-2000 | Poor geometry |
| TDOA pair | 1000-5000 | 200-1000 | Depends on baseline |
| Multi-sensor fusion | 100-500 | 50-200 | 3+ sensors |

**Ellipse Orientation:**
- For DF (direction finding) sensors, the major axis is typically aligned with the bearing to target
- For TDOA, the major axis is perpendicular to the baseline between sensors
- Orientation is measured in degrees from true north (0° = north, 90° = east)

### 8.3 Measurement Model (for simulation)

To simulate entity reports from truth data, apply these noise models:

**1. Line-of-Sight Check:**
```typescript
// Horizon calculation (simplified)
horizon_km = 3.57 × √(altitude_m)

// Check if target is visible
distance_to_target <= horizon_from_observer + horizon_from_target
```

**2. Geolocation Noise Model:**
```typescript
interface GeoNoiseModel {
  bearing_error_deg: number;      // 1-sigma AOA error (e.g., 2-5°)
  range_error_percent: number;    // 1-sigma range error (e.g., 5-15%)
  min_detection_amplitude: number; // dBm threshold
}
```

**3. Signal Parameter Noise Model:**
```typescript
interface SignalNoiseModel {
  frequency_error_mhz: number;    // 1-sigma (e.g., 0.5-5 MHz)
  pri_error_us: number;           // 1-sigma (e.g., 1-10 μs)
  pulsewidth_error_us: number;    // 1-sigma (e.g., 0.1-1 μs)
  amplitude_error_db: number;     // 1-sigma (e.g., 2-5 dB)
}
```

**Different endpoints should have different noise characteristics** to simulate varying sensor capabilities.

---

## 9. Key Design Principles

### 9.1 Why source_entity_uuid ≠ entity_msg_uuid

The server assigns a new `entity_msg_uuid` for every incoming report because:

1. **Server cannot trust endpoint correlation** - Endpoints vary in sophistication
2. **Some endpoints are "smart"** - They track entities internally and reuse source_entity_uuid
3. **Some endpoints are "simple"** - They report every observation as unique
4. **Server-side correlation provides consistency** - Same algorithm regardless of endpoint behavior

### 9.2 Why fusedEntitySummary is Historical

Each state update creates a NEW row (rather than updating in place):

1. **Forensic analysis** - Understand how estimates evolved over time
2. **Rollback/audit** - Recover previous state if needed
3. **Track reconstruction** - Replay historical tracks
4. **Live world queries latest** - Always gets current state efficiently

### 9.3 Why Live World Has Two Origins

The live world model has entries from two different sources:

1. **Fused entities** (`origin = "fused_entity_summary"`):
   - Derived from RF observations through the full fusion pipeline
   - Represent detected emitters (radars, jammers, comms, etc.)
   - Multiple sensors may contribute to position estimate

2. **DiSCO endpoints** (`origin = "position_report"`):
   - Known directly via self-reported position
   - No RF sensing needed - endpoint knows where it is
   - Represents friendly platforms in the operating picture

Both types appear on the Common Operating Picture as distinct entity types.

### 9.4 Why group_uuid Matters

The `group_uuid` enables critical data provenance:

- **Drill down**: From live world → summary → raw entity reports
- **Answer**: "Which endpoints saw this entity?"
- **Answer**: "What entities did this endpoint observe?"
- **Trace**: Understand how a fused position was calculated

---

## 10. API Endpoints Reference

### 10.1 entities API (9 implemented, 4 planned)

**✓ Implemented:**
```
POST   /apidocs/entities                                  - Add new Entity Report
POST   /apidocs/entities/batchInsert                      - Batch add (canonical, accepts bare array or {reports:[]})
POST   /apidocs/entities/batch                            - Batch add (legacy alias)
GET    /apidocs/entities/getLatest                        - Get latest Entity Reports
         ?from_time=&to_time=                              - Filter by latest_timestamp range
         ?from_write_time=&to_write_time=                  - Filter by created_timestamp range (cursor-based polling)
         ?max_count=                                       - Limit results (default 1000)
GET    /apidocs/entities/getByParams                      - Query by parameters
GET    /apidocs/entities/getUuids                         - List UUIDs
GET    /apidocs/entities/{entity_msg_uuid}                - Get by UUID
DELETE /apidocs/entities/{entity_msg_uuid}                - Delete by UUID
```

**[PLANNED]:**
```
PUT    /apidocs/entities                                  - Update Entity Report
POST   /apidocs/entities/getBatch                         - Get batch by UUIDs
GET    /apidocs/entities/getLatest/{source_entity_uuid}   - Latest by source UUID
GET    /apidocs/entities/getPositions                     - Query positions
```

### 10.2 positionReports API (9 implemented, 3 planned)

**✓ Implemented:**
```
POST   /apidocs/positionReports                           - Add new Position Report
POST   /apidocs/positionReports/batchInsert               - Batch add (canonical, accepts bare array or {reports:[]})
POST   /apidocs/positionReports/batch                     - Batch add (legacy alias)
GET    /apidocs/positionReports/getLatest                 - Get latest
         ?from_time=&to_time=                              - Filter by latest_timestamp range
         ?from_write_time=&to_write_time=                  - Filter by created_timestamp range (cursor-based polling)
         ?max_count=                                       - Limit results (default 1000)
GET    /apidocs/positionReports/getByParams               - Query by parameters
GET    /apidocs/positionReports/getLatestPerEndpoint      - Get latest per endpoint
GET    /apidocs/positionReports/getUuids                  - List UUIDs
GET    /apidocs/positionReports/{uuid}                    - Get by UUID
DELETE /apidocs/positionReports/{uuid}                    - Delete by UUID
```

**[PLANNED]:**
```
PUT    /apidocs/positionReports                           - Update Position Report
POST   /apidocs/positionReports/getBatchBySource          - Get batch by source UUIDs
GET    /apidocs/positionReports/getPositions              - Query positions
```

### 10.3 fusedEntityMapping API **[PLANNED - NOT YET IMPLEMENTED]**

```
POST   /apidocs/fusedEntityMapping                        - Add new mapping
PUT    /apidocs/fusedEntityMapping                        - Update mapping
POST   /apidocs/fusedEntityMapping/batchInsert            - Batch add
POST   /apidocs/fusedEntityMapping/getBatch               - Get batch by UUIDs
GET    /apidocs/fusedEntityMapping/getByParams            - Query by parameters
GET    /apidocs/fusedEntityMapping/getLatest              - Get latest
GET    /apidocs/fusedEntityMapping/getUuids               - List UUIDs
GET    /apidocs/fusedEntityMapping/{uuid}                 - Get by UUID
DELETE /apidocs/fusedEntityMapping/{uuid}                 - Delete by UUID
```

### 10.4 fusedEntitySummary API **[PLANNED - NOT YET IMPLEMENTED]**

```
POST   /apidocs/fusedEntitySummary                        - Add new summary
PUT    /apidocs/fusedEntitySummary                        - Update summary
POST   /apidocs/fusedEntitySummary/batchInsert            - Batch add
POST   /apidocs/fusedEntitySummary/getBatch               - Get batch by UUIDs
GET    /apidocs/fusedEntitySummary/getByParams            - Query by parameters
GET    /apidocs/fusedEntitySummary/getLatest              - Get latest
GET    /apidocs/fusedEntitySummary/getUuids               - List UUIDs
GET    /apidocs/fusedEntitySummary/{uuid}                 - Get by UUID
DELETE /apidocs/fusedEntitySummary/{uuid}                 - Delete by UUID
```

### 10.5 liveWorldModel API (8 endpoints)

```
POST   /apidocs/liveWorldModel                            - Add new record
PUT    /apidocs/liveWorldModel                            - Update record
GET    /apidocs/liveWorldModel/getDelta                   - Get changes since timestamp
GET    /apidocs/liveWorldModel/getByParams                - Query by parameters
GET    /apidocs/liveWorldModel/getLatest                  - Get latest (current impl)
GET    /apidocs/liveWorldModel/getUuids                   - List UUIDs by origin
GET    /apidocs/liveWorldModel/{uuid}                     - Get by origin UUID
DELETE /apidocs/liveWorldModel/{uuid}                     - Delete by UUID
```

### 10.6 Server Management API (port 8765)

```
GET    /apidocs/health                                    - Health check (status, counts, uptime)
GET    /apidocs/server/status                             - Server status (uptime, store counts, capacity)
GET    /apidocs/server/memory                             - Memory usage (RSS, heap, DB size, 2GB limit %)
POST   /apidocs/server/clearStores                        - Clear all database tables
GET    /apidocs/metrics                                   - Metrics snapshot (rates, counts, history)
```

### 10.8 Data Emulator Control API (port 8766)

> **Note**: These endpoints live on the **Data Emulator** service (port 8766, `/api/` prefix), NOT on the Surrogate Server (port 8765, `/apidocs/` prefix). The emulator is a separate service that POSTs reports to the server.

```
GET    /api/health                                        - Emulator health check
GET    /api/status                                        - Simulation status (running, entities, tick, etc.)
GET    /api/configs                                       - List available JSON config files with metadata
GET    /api/memory                                        - Memory usage (RSS, heap)
POST   /api/simulation/start                              - Start simulation from config { configFile: "path" }
POST   /api/simulation/stop                               - Stop and destroy simulation
POST   /api/simulation/pause                              - Pause simulation tick loop
POST   /api/simulation/resume                             - Resume simulation tick loop
GET    /api/config                                        - Get current config (target URL, config file)
POST   /api/config/targetServer                           - Set target server URL
```

### 10.9 Endpoint Management (port 8766)

```
GET    /api/endpoints                                     - Get all endpoints with state
POST   /api/endpoints/:uuid/pause                         - Pause specific endpoint
POST   /api/endpoints/:uuid/resume                        - Resume specific endpoint
POST   /api/endpoints/pauseAll                            - Pause all endpoints
POST   /api/endpoints/resumeAll                           - Resume all endpoints
```

---

## See Also

- [disco-overview.md](disco-overview.md) - Product overview and context
- [entity-reporting-implementation-plan.md](entity-reporting-implementation-plan.md) - Implementation plan for entity/position reporting
- `disco_live_world_client_ui/javascript-client/` - Auto-generated API client with detailed schema definitions
